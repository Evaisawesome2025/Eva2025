substitutions:
  _REGION: us-central1
  _REPO: eva-reg
  _SERVICE: eva
steps:
- name: gcr.io/cloud-builders/docker
  args: ['build','-t','${_REGION}-docker.pkg.dev/black-stream-468918-m5/${_REPO}/${_SERVICE}:$SHORT_SHA','.']
- name: gcr.io/cloud-builders/docker
  args: ['push','${_REGION}-docker.pkg.dev/black-stream-468918-m5/${_REPO}/${_SERVICE}:$SHORT_SHA']
- name: gcr.io/google.com/cloudsdktool/cloud-sdk
  entrypoint: gcloud
  args: ['run','deploy','${_SERVICE}','--image','${_REGION}-docker.pkg.dev/black-stream-468918-m5/${_REPO}/${_SERVICE}:$SHORT_SHA',
         '--region','${_REGION}','--platform','managed','--allow-unauthenticated',
         '--cpu','1','--memory','512Mi','--min-instances','0','--max-instances','3','--concurrency','80']
images:
- '${_REGION}-docker.pkg.dev/black-stream-468918-m5/${_REPO}/${_SERVICE}:$SHORT_SHA'
